paths:
  /auth/register:
    post:
      tags: [Authentication]
      summary: Register new user account
      description: |
        Create a new user account with email and password. Password must meet complexity requirements.
        
        **Rate Limit**: 5 attempts per 15 minutes per IP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                  description: Valid email address
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePass123!
                  description: Minimum 8 characters with uppercase, lowercase, number and symbol
                name:
                  type: string
                  maxLength: 100
                  example: John Doe
                  description: Optional display name
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User registered successfully
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        description: JWT access token (15 minutes)
                      refreshToken:
                        type: string
                        description: JWT refresh token (7 days)
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Error'
                  - properties:
                      errorCode:
                        const: USER_EXISTS
              example:
                success: false
                error: Email already registered
                errorCode: USER_EXISTS
                timestamp: 2025-11-12T10:30:00.000Z
        '429':
          $ref: '#/components/responses/RateLimitError'

  /auth/login:
    post:
      tags: [Authentication]
      summary: User login
      description: |
        Authenticate user with email and password. Returns JWT tokens for session management.
        
        **Rate Limit**: 5 attempts per 15 minutes per IP
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
                totpCode:
                  type: string
                  pattern: '^[0-9]{6}$'
                  example: '123456'
                  description: 6-digit TOTP code (required if 2FA enabled)
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Login successful
                  user:
                    $ref: '#/components/schemas/User'
                  tokens:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        description: JWT access token (15 minutes)
                      refreshToken:
                        type: string
                        description: JWT refresh token (7 days)
                  requiresTwoFactor:
                    type: boolean
                    example: false
                    description: True if 2FA is enabled but not provided
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          description: Invalid credentials or 2FA required
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Error'
                  - properties:
                      errorCode:
                        enum: [INVALID_CREDENTIALS, INVALID_2FA_CODE, 2FA_REQUIRED]
              examples:
                invalid_credentials:
                  summary: Wrong email or password
                  value:
                    success: false
                    error: Invalid email or password
                    errorCode: INVALID_CREDENTIALS
                    timestamp: 2025-11-12T10:30:00.000Z
                2fa_required:
                  summary: 2FA code required
                  value:
                    success: false
                    error: Two-factor authentication code required
                    errorCode: 2FA_REQUIRED
                    timestamp: 2025-11-12T10:30:00.000Z
        '429':
          $ref: '#/components/responses/RateLimitError'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: User logout
      description: |
        Invalidate current session and add tokens to blacklist. Requires authentication.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      message:
                        type: string
                        example: Logout successful
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/profile:
    get:
      tags: [Authentication]
      summary: Get user profile
      description: Retrieve current user's profile information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    patch:
      tags: [Authentication]  
      summary: Update user profile
      description: Update user profile information (name, preferences)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 100
                  example: John Smith
                preferences:
                  $ref: '#/components/schemas/UserPreferences'
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Profile updated successfully
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/change-password:
    post:
      tags: [Authentication]
      summary: Change user password
      description: |
        Change user password. Requires current password for verification.
        
        **Rate Limit**: 3 attempts per 15 minutes per user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [currentPassword, newPassword]
              properties:
                currentPassword:
                  type: string
                  format: password
                  example: OldPass123!
                newPassword:
                  type: string
                  format: password
                  minLength: 8
                  example: NewSecurePass456!
                  description: Minimum 8 characters with uppercase, lowercase, number and symbol
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - properties:
                      message:
                        type: string
                        example: Password changed successfully
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          description: Current password incorrect or unauthorized
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Error'
                  - properties:
                      errorCode:
                        enum: [INVALID_CURRENT_PASSWORD, TOKEN_INVALID]
        '429':
          $ref: '#/components/responses/RateLimitError'